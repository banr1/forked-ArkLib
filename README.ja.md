# 形式的に検証された「知識の引数」

> Formally Verified Arguments of Knowledge

このライブラリは、簡潔非対話型知識証明（SNARKs: succinct non‑interactive arguments of knowledge）を形式的に検証するための、モジュール式で合成可能なフレームワークの提供を目的としています。これは [verified-zkevm](https://verified-zkevm.org/) の取り組みの一環として進められています。

開発の第1段階では、（今日のほとんどの SNARK に共通する情報理論的な中核である）インタラクティブな（オラクル）還元を形式化し、選定したいくつかのプロトコルについて完全性と健全性を証明する計画です（下記の「進行中の形式化」を参照）。

各プロトコルについて、次の提供を目指します。

- 合成およびリフティング用インタフェースを用いてモジュール的に構成された、当該プロトコルの実行可能仕様。
- 合成とリフティングに関する一般定理に基づく、完全性およびラウンドごとの知識健全性の証明。

将来的には、特定のプロトコル（例: sum-check、FRI、WHIR）について、実行可能仕様（あるいはその変更版）と、同一プロトコルの Rust 実装（[hax](https://github.com/cryspen/hax) により抽出されたコード）との関数的同値性の検証も行う予定です。

## ライブラリ構成

本ライブラリの中核は、機械化された **インタラクティブ・オラクル還元**（Interactive Oracle Reductions、[OracleReduction](ArkLib/OracleReduction) を参照）の理論です。

1. **IOR**（本形式化では `OracleReduction`）は、公開ステートメントと秘密の証人に関する関係 $$R_1$$ を、別の関係 $$R_2$$ へと還元するための、証明者と検証者によるインタラクティブ・プロトコルです。
2. 検証者は、証明者が送るメッセージを平文として直接見るのではなく、規定されたオラクル・インタフェースを介してそれらのメッセージにクエリできます。
   - 例えば、メッセージをベクトルとして見なし、その成分を問い合わせることができます。あるいは、メッセージを多項式として見なし、指定点での評価値を問い合わせることもできます。
3. 互換な関係を持つ複数の IOR（例: $$R_1 \implies R_2$$ と $$R_2 \implies R_3$$）を順次合成（sequential composition）でき、多くの場合その安全性（セキュリティ）を保存できます。また、単純な文脈（すなわちステートメントと証人の入出力対）で定義された IOR を、より大きく複雑な文脈へとリフトして、**仮想**オラクル還元を構成できます。
   - この二つの操作（順次合成とリフティング）により、既存のプロトコル（例: Plonk）を共通のサブルーチン（例: zero check、permutation check、quotienting）から構成し、構成要素の安全性から得られる結論として、構成されたプロトコルの安全性を導きます。
4. 望む IOR を記述した後は、それを **非対話型**の知識引数へと変換します。多くの場合、次の二段階で行います。
   - まず **（インタラクティブ）BCS 変換**を適用し、適切な **（関数的）コミットメント・スキーム**を用いて IOR におけるメッセージ・オラクルを具体化します。概略的には、関数的コミットメント・スキームはコミットメント手続きと、指定されたオラクル・インタフェースの正しさを示す開示（opening）引数から構成されます。
   - インタラクティブ BCS 変換では、証明者の各オラクル・メッセージをそのメッセージへのコミットメントに置き換え、検証者が行う各オラクル・クエリに対して開示引数を実行します。これらの開示引数はバッチ化できる場合があります。
   - 続いて **Fiat–Shamir 変換**を適用し、ハッシュ関数（ランダム・オラクルとしてモデル化）へのクエリを通じて、証明者が検証者のランダム・チャレンジを導出することで相互作用を折りたたみます。実用上の効率のため、暗号学的スポンジを用いる **デュプレックス・スポンジ**版 Fiat–Shamir を形式化します。
5. 本形式化は、IOR を現代の SNARK における中心的な情報理論的対象とみなす近年の見方に従います。また、インタラクティブ BCS と Fiat–Shamir 変換に関する最新の理解と抽象化を採用しています。関連分野の歴史的背景については（作業中の）[BACKGROUND](./BACKGROUND.md) を参照してください。

インタラクティブ・オラクル還元の理論を用いて、[ProofSystem](ArkLib/ProofSystem) において各種の証明系を形式化しています。

## 進行中の形式化（最終更新: 2025年8月7日）

本ライブラリは現在開発中です。基盤理論の整備と並行して、以下の暗号要素の形式化を進めています。

- Sum-Check プロトコル
- Spartan
- Merkle 木
- FRI と符号理論の前提事項
- STIR と WHIR
- Binius

[VCV-io](https://github.com/dtumad/VCV-io) は、[mathlib](https://github.com/leanprover-community/mathlib4) と並ぶ ArkLib の主要依存であり、同時並行で開発が進んでいます。また、（フォークした）[iris-lean](https://github.com/Verified-zkEVM/iris-lean) 上で、[Bluebell](https://arxiv.org/pdf/2402.18708) 確率的プログラム論理の取り組みも開始しています。

## ロードマップと貢献

外部からの貢献を歓迎します。詳細は [CONTRIBUTING](./CONTRIBUTING.md)、即応可能なタスクのための issue 一覧、および望ましい貢献内容をまとめた [ROADMAP](./ROADMAP.md) をご覧ください。

issue やロードマップに挙がっている項目への参加に関心がある場合は、[verified-zkevm.org](https://verified-zkevm.org/)、[著者陣](mailto:qvd@andrew.cmu.edu) への連絡、または新しい issue の作成から始めてください。

## リリーススケジュール

新しいリリースは、Lean および mathlib のリリースサイクルに合わせる計画です。
